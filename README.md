# 视频文本同步跟读

一个基于 Flask 的 Web 应用，可以将视频内容转换为文本，并实现视频播放与文本实时同步高亮显示。

## 核心功能

### 1. 视频输入
- 支持 YouTube 链接输入
- 支持本地 MP4 文件上传

### 2. 语音转文字
- 调用 SenseVoice API 进行语音识别
- 生成带时间戳的文本内容

### 3. 视频文本同步
- 视频播放时文本实时高亮
- 根据音频进度自动滚动文本
- 点击文本片段可跳转到视频相应位置

### 4. 历史记录
- 记录用户的视频处理历史
- 支持按时间顺序查看历史记录
- 提供快速访问之前处理过的视频
- 历史记录包含：
  - 视频标题和来源（上传/YouTube）
  - 处理时间
  - 视频时长和大小
  - 转写文本预览
  - 一键重新播放功能

## 用户使用流程

### 1. 主界面
- 显示所有历史记录（按时间倒序排列）
- 提供视频处理入口：
  - 上传本地视频
  - 下载YouTube视频
- 历史记录展示内容：
  - 视频标题
  - 来源（本地上传/YouTube）
  - 处理时间
  - 视频时长
  - 转录状态（未转录/已转录）
  - 操作按钮（播放/转录）

### 2. 视频下载流程
1. 用户输入YouTube链接
2. 点击下载按钮
3. 系统下载视频到downloads文件夹
4. 在历史记录中显示下载的视频
5. 用户可选择是否进行转录
6. 转录完成后更新历史记录状态

### 3. 视频上传流程
1. 用户选择本地视频文件
2. 系统将视频保存到uploads文件夹
3. 在历史记录中显示上传的视频
4. 用户可选择是否进行转录
5. 转录完成后更新历史记录状态

### 4. 历史记录管理
- 支持查看所有处理过的视频
- 可以重新播放任意历史视频
- 未转录的视频可以启动转录
- 已转录的视频可以直接查看文本
- 支持删除历史记录

## 技术栈

### 后端
- Flask (Python Web 框架)
  - Flask-RESTful (用于构建 RESTful API)
- Supabase (数据库服务)
  - 存储历史记录
  - 视频元数据管理
  - 转录结果存储
- 阿里云 OSS (对象存储)
  - 视频文件存储
  - 支持视频流式播放
- DashScope (语音转写服务)
  - SenseVoice API 集成
  - 支持多语言转写
- yt-dlp (YouTube 视频下载)
  - 支持高清视频下载
  - 自动处理字幕
- moviepy (视频处理)
  - 视频信息提取
  - 时长、分辨率计算

### 前端
- HTML5 
  - 视频播放器
  - 文件上传
- CSS3 
  - 响应式设计
  - 动画效果
- JavaScript 
  - 视频文本同步
  - 进度跟踪
  - 历史记录管理

### 存储方案设计

#### Supabase 数据结构
- 视频历史记录表 (video_history):
  ```json
  {
    "id": "UUID",
    "title": "视频标题",
    "source": "upload/youtube",
    "video_path": "OSS存储路径",
    "duration": "视频时长",
    "file_size": "文件大小",
    "fps": "帧率",
    "resolution": "分辨率",
    "created_at": "创建时间",
    "transcribed": "转写状态",
    "transcription": "纯文本转写结果",
    "origin": "带时间戳的原始转写文本"
  }
  ```

#### OSS 存储结构
- 视频文件存储
- 支持流式访问
- 自动生成唯一文件名
- 支持临时访问URL

### 主要功能
- 多来源视频支持
- 自动视频信息提取
- 实时转写进度跟踪
- 完整的历史记录管理

project/
├── app.py # Flask 应用入口
├── config.py # 配置文件，包括目录、Redis 等设置
├── requirements.txt # 项目依赖
├── .env # 环境变量配置
├── Readme.md # 项目说明文件
├── records/ # 视频记录目录（由 Config.init_folders 创建）
├── services/
│ ├── video_service.py # 视频处理服务模块（处理上传、转录、OSS存储等）
│ └── youtube_service.py # YouTube 视频处理服务模块
├── static/
│ ├── css/
│ │ ├── style.css # 全局样式及页面基础样式
│ │ └── history.css # 历史记录区域样式
│ ├── js/
│ │ ├── player.js # 视频播放器相关逻辑
│ │ ├── history.js # 历史记录管理脚本
│ │ └── main.js # 首页逻辑（入口 JavaScript 文件）
│ └── (其他静态资源)
└── templates/
├── index.html # 首页模板（包含 YouTube 下载、本地上传及历史记录展示）
└── player.html # 视频播放页面模板（提供播放器和转录结果显示）